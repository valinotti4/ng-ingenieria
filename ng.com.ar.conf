<VirtualHost 149.50.131.152:80 [2800:6c0:5::2a0]:80>
    SuexecUserGroup #1003 #1002
    ServerName ng.com.ar
    ServerAlias www.ng.com.ar
    ServerAlias mail.ng.com.ar
    ServerAlias webmail.ng.com.ar
    ServerAlias admin.ng.com.ar
    DocumentRoot /home/ng/public_html
    ErrorLog /var/log/virtualmin/ng.com.ar_error_log
    CustomLog /var/log/virtualmin/ng.com.ar_access_log combined
    ScriptAlias /cgi-bin/ /home/ng/cgi-bin/
    ScriptAlias /awstats /home/ng/cgi-bin/awstats.pl
    DirectoryIndex index.php index.htm index.html
    <Directory /home/ng/public_html>
        Options -Indexes +IncludesNOEXEC +SymLinksIfOwnerMatch 
        Require all granted
        AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
    </Directory>
    <Directory /home/ng/cgi-bin>
        Require all granted
        AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
    </Directory>
    ProxyPass /.well-known !
    RewriteEngine on
    RewriteCond %{HTTP_HOST} =webmail.ng.com.ar
    RewriteRule ^/(?!.well-known)(.*)$ https://ng.com.ar:20000/ [R]
    RewriteCond %{HTTP_HOST} =admin.ng.com.ar
    RewriteRule ^/(?!.well-known)(.*)$ https://ng.com.ar:10000/ [R]
    RemoveHandler .php
    RemoveHandler .php8.2
    <FilesMatch \.php$>
        SetHandler proxy:unix:/run/php/1754673173265581.sock|fcgi://127.0.0.1
    </FilesMatch>
    RedirectMatch ^/awstats$ /awstats/
    <Files awstats.pl>
        AuthName "ng.com.ar statistics"
        AuthType Basic
        AuthUserFile /home/ng/.awstats-htpasswd
        require valid-user
    </Files>

    # Next.js proxy configuration
    Alias /meteo /home/ng/public_html/meteo
    <Directory "/home/ng/public_html/meteo">
        AllowOverride All
        Require all granted
    </Directory>
    ProxyPreserveHost On
    ProxyTimeout 300
    ProxyPass /meteo !
    ProxyPass /cgi-bin !
    ProxyPass /awstats !
    ProxyPass /_next/ http://localhost:3000/_next/
    ProxyPassReverse /_next/ http://localhost:3000/_next/
    ProxyPass /api/ http://localhost:3000/api/
    ProxyPassReverse /api/ http://localhost:3000/api/
    ProxyPass /favicon.ico http://localhost:3000/favicon.ico
    ProxyPassReverse /favicon.ico http://localhost:3000/favicon.ico
    ProxyPass / http://localhost:3000/
    ProxyPassReverse / http://localhost:3000/
</VirtualHost>
<VirtualHost 149.50.131.152:443 [2800:6c0:5::2a0]:443>
    SuexecUserGroup #1003 #1002
    ServerName ng.com.ar
    ServerAlias www.ng.com.ar
    ServerAlias mail.ng.com.ar
    ServerAlias webmail.ng.com.ar
    ServerAlias admin.ng.com.ar
    DocumentRoot /home/ng/public_html
    ErrorLog /var/log/virtualmin/ng.com.ar_error_log
    CustomLog /var/log/virtualmin/ng.com.ar_access_log combined
    ScriptAlias /cgi-bin/ /home/ng/cgi-bin/
    ScriptAlias /awstats /home/ng/cgi-bin/awstats.pl
    DirectoryIndex index.php index.htm index.html
    <Directory /home/ng/public_html>
        Options -Indexes +IncludesNOEXEC +SymLinksIfOwnerMatch 
        Require all granted
        AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
    </Directory>
    <Directory /home/ng/cgi-bin>
        Require all granted
        AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
    </Directory>
    ProxyPass /.well-known !
    RewriteEngine on
    RewriteCond %{HTTP_HOST} =webmail.ng.com.ar
    RewriteRule ^/(?!.well-known)(.*)$ https://ng.com.ar:20000/ [R]
    RewriteCond %{HTTP_HOST} =admin.ng.com.ar
    RewriteRule ^/(?!.well-known)(.*)$ https://ng.com.ar:10000/ [R]
    RemoveHandler .php
    RemoveHandler .php8.2
    <FilesMatch \.php$>
        SetHandler proxy:unix:/run/php/1754673173265581.sock|fcgi://127.0.0.1
    </FilesMatch>
    SSLEngine on
    SSLCertificateFile /etc/ssl/virtualmin/1754673173265581/ssl.cert
    SSLCertificateKeyFile /etc/ssl/virtualmin/1754673173265581/ssl.key
    SSLProtocol all -SSLv2 -SSLv3 -TLSv1 -TLSv1.1
    RedirectMatch ^/awstats$ /awstats/
    <Files awstats.pl>
        AuthName "ng.com.ar statistics"
        AuthType Basic
        AuthUserFile /home/ng/.awstats-htpasswd
        require valid-user
    </Files>
    SSLCACertificateFile /etc/ssl/virtualmin/1754673173265581/ssl.ca

    # Next.js proxy configuration
    Alias /meteo /home/ng/public_html/meteo
    <Directory "/home/ng/public_html/meteo">
        AllowOverride All
        Require all granted
    </Directory>
    ProxyPreserveHost On
    ProxyTimeout 300
    ProxyPass /meteo !
    ProxyPass /cgi-bin !
    ProxyPass /awstats !
    ProxyPass /_next/ http://localhost:3000/_next/
    ProxyPassReverse /_next/ http://localhost:3000/_next/
    ProxyPass /api/ http://localhost:3000/api/
    ProxyPassReverse /api/ http://localhost:3000/api/
    ProxyPass /favicon.ico http://localhost:3000/favicon.ico
    ProxyPassReverse /favicon.ico http://localhost:3000/favicon.ico
    ProxyPass / http://localhost:3000/
    ProxyPassReverse / http://localhost:3000/
</VirtualHost>
